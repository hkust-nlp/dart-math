<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>🎯DART-Math</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./quick-start.html" rel="next">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c16f70d9e6245094a6412faf456d4b9c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="🎯DART-Math">
<meta property="og:description" content="🎯DART-Math: Difficulty-Aware Rejection Tuning for Mathematical Problem-Solving">
<meta property="og:site_name" content="🎯DART-Math">
<meta name="twitter:title" content="🎯DART-Math">
<meta name="twitter:description" content="🎯DART-Math: Difficulty-Aware Rejection Tuning for Mathematical Problem-Solving">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">🎯DART-Math</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/hkust-nlp/dart-math"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./index.html">🎯DART-Math</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">🎯DART-Math</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quick-start.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./train.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Training</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eval.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(Math) Evalution</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parallel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Parallelism</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Code Execution</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Utilities</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#dart-math-models-sota-on-various-in-domain-and-out-of-domain-benchmarks" id="toc-dart-math-models-sota-on-various-in-domain-and-out-of-domain-benchmarks" class="nav-link active" data-scroll-target="#dart-math-models-sota-on-various-in-domain-and-out-of-domain-benchmarks"><code>DART-Math</code> Models: SOTA on Various In-Domain and Out-of-Domain Benchmarks</a></li>
  <li><a href="#dart-math-datasets-sota-data-efficient-open-source" id="toc-dart-math-datasets-sota-data-efficient-open-source" class="nav-link" data-scroll-target="#dart-math-datasets-sota-data-efficient-open-source"><code>DART-Math</code> Datasets: SOTA &amp; Data-Efficient &amp; Open-Source</a></li>
  <li><a href="#dars-difficulty-aware-rejection-sampling" id="toc-dars-difficulty-aware-rejection-sampling" class="nav-link" data-scroll-target="#dars-difficulty-aware-rejection-sampling"><code>DARS</code> – Difficulty-Aware Rejection Sampling</a></li>
  <li><a href="#quick-start-reproduction" id="toc-quick-start-reproduction" class="nav-link" data-scroll-target="#quick-start-reproduction">🚀 Quick Start / Reproduction</a>
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">⚙️ Setup</a></li>
  <li><a href="#training" id="toc-training" class="nav-link" data-scroll-target="#training">🔨 Training</a>
  <ul class="collapse">
  <li><a href="#single-node-training" id="toc-single-node-training" class="nav-link" data-scroll-target="#single-node-training">Single-Node Training</a></li>
  <li><a href="#multi-node-training" id="toc-multi-node-training" class="nav-link" data-scroll-target="#multi-node-training">Multi-Node Training</a></li>
  </ul></li>
  <li><a href="#evaluation" id="toc-evaluation" class="nav-link" data-scroll-target="#evaluation">⚖️ Evaluation</a></li>
  <li><a href="#data-synthesis" id="toc-data-synthesis" class="nav-link" data-scroll-target="#data-synthesis">🗂 Data Synthesis</a></li>
  </ul></li>
  <li><a href="#dart-math-package-efficient-and-flexible-training-inference-evaluation-pipelines" id="toc-dart-math-package-efficient-and-flexible-training-inference-evaluation-pipelines" class="nav-link" data-scroll-target="#dart-math-package-efficient-and-flexible-training-inference-evaluation-pipelines"><code>dart-math</code> Package: Efficient and Flexible Training &amp; Inference &amp; Evaluation Pipelines</a>
  <ul>
  <li><a href="#tool-integrated-reasoning-reasoning-in-natural-language-interleaved-with-python-code" id="toc-tool-integrated-reasoning-reasoning-in-natural-language-interleaved-with-python-code" class="nav-link" data-scroll-target="#tool-integrated-reasoning-reasoning-in-natural-language-interleaved-with-python-code"><strong>Tool-integrated reasoning</strong>: reasoning in natural language interleaved with Python code</a></li>
  </ul></li>
  <li><a href="#contribution" id="toc-contribution" class="nav-link" data-scroll-target="#contribution">🍀 Contribution</a>
  <ul>
  <li><a href="#file-structure" id="toc-file-structure" class="nav-link" data-scroll-target="#file-structure">File Structure</a></li>
  <li><a href="#checklist-before-commit" id="toc-checklist-before-commit" class="nav-link" data-scroll-target="#checklist-before-commit">Checklist Before Commit</a>
  <ul class="collapse">
  <li><a href="#prepare-commit.sh" id="toc-prepare-commit.sh" class="nav-link" data-scroll-target="#prepare-commit.sh"><code>prepare-commit.sh</code></a></li>
  <li><a href="#manual-modification-list" id="toc-manual-modification-list" class="nav-link" data-scroll-target="#manual-modification-list">Manual Modification List</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#star-history" id="toc-star-history" class="nav-link" data-scroll-target="#star-history">🌟 Star History</a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">🙏 Acknowledgements</a></li>
  <li><a href="#citation" id="toc-citation" class="nav-link" data-scroll-target="#citation">☕️ Citation</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/hkust-nlp/dart-math/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">🎯DART-Math</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<blockquote class="blockquote">
<p>Difficulty-Aware Rejection Tuning for Mathematical Problem-Solving [NeurIPS 2024]</p>
<p><a href="https://tongyx361.github.io">Yuxuan Tong</a>, Xiwen Zhang, Rui Wang, Ruidong Wu, <a href="https://jxhe.github.io">Junxian He</a></p>
</blockquote>
<p>📝 <a href="https://arxiv.org/abs/2407.13690">Paper@arXiv</a>&nbsp;|&nbsp;🤗 <a href="https://huggingface.co/collections/hkust-nlp/dart-math-665704599b35de59f8fdf6c1">Datasets&amp;Models@HF</a> | 🐱 <a href="https://github.com/hkust-nlp/dart-math">Code@GitHub</a> | 💡 <a href="https://docs.google.com/presentation/d/1ZBPsM5Ww3XbQo3zAE6y-lpfsWLsK6cAbCsF6lbNHDY4/edit?usp=sharing">Slides</a> | 🏆 <a href="https://nips.cc/virtual/2024/poster/92959">Published@NeurIPS 2024</a></p>
<p>🐦 <a href="https://x.com/tongyx361/status/1811413243350454455">Thread@X(Twitter)</a> | 🐶 <a href="https://zhuanlan.zhihu.com/p/708371895">中文博客@知乎</a> | 📊 <a href="https://paperswithcode.com/paper/dart-math-difficulty-aware-rejection-tuning#results">Leaderboard@PapersWithCode</a> | 📑 <a href="https://github.com/hkust-nlp/dart-math?tab=readme-ov-file#%EF%B8%8F-citation">BibTeX</a></p>
<blockquote class="blockquote">
<p>[!IMPORTANT]</p>
<p>🔥 <strong>News!!!</strong></p>
<ul>
<li>[2024/09/25] 🎉 <em>DART-Math</em> is accepted to <a href="https://nips.cc/virtual/2024/poster/92959"><em>NeurIPS 2024</em></a>!</li>
<li>[2024/07/21] Excited to find <strong>our <a href="https://huggingface.co/hkust-nlp/dart-math-dsmath-7b-prop2diff"><code>DART-Math-DSMath-7B</code> (Prop2Diff)</a> <a href="https://github.com/project-numina/aimo-progress-prize/blob/main/report/numina_dataset.pdf">comparable</a> to the AIMO winner <a href="https://huggingface.co/AI-MO/NuminaMath-7B-CoT">NuminaMath-7B</a></strong> on CoT, but based solely on <a href="https://huggingface.co/datasets/hkust-nlp/dart-math-pool-math-query-info">MATH</a> &amp; <a href="https://huggingface.co/datasets/hkust-nlp/dart-math-pool-gsm8k-query-info">GSM8K</a> prompt set, leaving much room to improve! Besides, our <a href="https://github.com/hkust-nlp/dart-math?tab=readme-ov-file#dars--difficulty-aware-rejection-sampling"><code>DART</code> method</a> is also fully <a href="https://github.com/hkust-nlp/dart-math?tab=readme-ov-file#tool-integrated-reasoning-reasoning-in-natural-language-interleaved-with-python-code">compatible with tool-integrated reasoning</a>. Join the discussion under this <a href="https://x.com/tongyx361/status/1815112376649134172">X thread</a>!</li>
</ul>
</blockquote>
<p><img src="https://neurips.cc/media/PosterPDFs/NeurIPS%202024/92959.png" class="img-fluid"></p>
<div data-align="center">
<p><img src="https://tongyx361.github.io/assets/dart-math/main-results.png" alt="Main results averaged on 2 in-domain and 4 challenging out-of-domain mathematical reasoning benchmarks." height="300px"> <img src="https://tongyx361.github.io/assets/dart-math/main-nresp-vs-query.png" alt="Number of responses v.s. query descending in difficulty in DART-Math datasets and similar-sized VRT baseline" height="300px"></p>
</div>
<div data-align="left">
<p><sup> Figure 1: <strong>Left:</strong> Average accuracy on 6 mathematical benchmarks. We compare with models fine-tuned on the best, public instruction tuning datasets for mathematical problem-solving: MetaMath <a href="https://openreview.net/forum?id=N8N0hgNDRt">(Yu et al., 2024)</a> with 395K examples, MMIQC <a href="https://arxiv.org/abs/2401.09003">(Liu et al., 2024a)</a> with 2.3 million examples, as well as vanilla rejection tuning (VRT) with 590K examples. Both <em>DART-Math (Uniform)</em> and <em>DART-Math (Prop2Diff)</em> use 590K training examples. <strong>Right:</strong> Number of responses for each query descending by difficulty across 3 synthesis strategies. Queries are from the MATH training split <a href="https://datasets-benchmarks-proceedings.neurips.cc/paper/2021/hash/be83ab3ecd0db773eb2dc1b0a17836a1-Abstract-round2.html">(Hendrycks et al., 2021)</a>. VRT is the baseline biased towards easy queries, while <em>Uniform</em> and <em>Prop2Diff</em> are proposed in this work to balance and bias towards difficult queries respectively. Points are slightly shifted and downsampled for clarity. </sup></p>
</div>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Dataset</th>
<th style="text-align: left;">Setting</th>
<th style="text-align: right;"># of Samples</th>
<th style="text-align: right;"><a href="https://huggingface.co/datasets/hendrycks/competition_math">MATH</a></th>
<th style="text-align: right;"><a href="https://huggingface.co/datasets/gsm8k">GSM8K</a></th>
<th style="text-align: right;"><a href="https://github.com/hkust-nlp/dart-math/tree/main/data/dsets/mwpbench/college-math-test.jsonl">College</a></th>
<th style="text-align: center;">Download</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>DART-Math-Uniform</code></td>
<td style="text-align: left;">Unifrom</td>
<td style="text-align: right;">591k</td>
<td style="text-align: right;">52.9</td>
<td style="text-align: right;"><strong>88.2</strong></td>
<td style="text-align: right;">40.1</td>
<td style="text-align: center;">🤗 <a href="https://huggingface.co/datasets/hkust-nlp/dart-math-uniform">HuggingFace</a></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>DART-Math-Hard</code></td>
<td style="text-align: left;">Prop2Diff</td>
<td style="text-align: right;">585k</td>
<td style="text-align: right;"><strong>53.6</strong></td>
<td style="text-align: right;">86.8</td>
<td style="text-align: right;"><strong>40.7</strong></td>
<td style="text-align: center;">🤗 <a href="https://huggingface.co/datasets/hkust-nlp/dart-math-hard">HuggingFace</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>DART-Math-Pool-MATH</code></td>
<td style="text-align: left;">–</td>
<td style="text-align: right;">1615k</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: center;">🤗 <a href="https://huggingface.co/datasets/hkust-nlp/dart-math-pool-math">HuggingFace</a></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>DART-Math-Pool-GSM8K</code></td>
<td style="text-align: left;">–</td>
<td style="text-align: right;">2739k</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: center;">🤗 <a href="https://huggingface.co/datasets/hkust-nlp/dart-math-pool-gsm8k">HuggingFace</a></td>
</tr>
</tbody>
</table>
<p><sup>MATH and GSM8K are <strong>in-domain</strong>, while College(Math) is <strong>out-of-domain</strong>. Performance here are of <code>DART-Math</code> models fine-tuned from <a href="https://huggingface.co/deepseek-ai/deepseek-math-7b-base">DeepSeekMath-7B</a>. <strong>Bold</strong> means the best score on the respective base model here.</sup></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;"><a href="https://huggingface.co/datasets/hendrycks/competition_math">MATH</a></th>
<th style="text-align: right;"><a href="https://huggingface.co/datasets/gsm8k">GSM8K</a></th>
<th style="text-align: right;"><a href="https://github.com/hkust-nlp/dart-math/tree/main/data/dsets/mwpbench/college-math-test.jsonl">CollegeMath</a></th>
<th style="text-align: center;">Download</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>DART-Math-Llama3-70B</code> (Uniform)</td>
<td style="text-align: right;">54.9</td>
<td style="text-align: right;"><strong>90.4</strong></td>
<td style="text-align: right;"><strong>38.5</strong></td>
<td style="text-align: center;">🤗 <a href="https://huggingface.co/hkust-nlp/dart-math-llama3-70b-uniform">HuggingFace</a></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>DART-Math-Llama3-70B</code> (Prop2Diff)</td>
<td style="text-align: right;"><strong>56.1</strong></td>
<td style="text-align: right;">89.6</td>
<td style="text-align: right;">37.9</td>
<td style="text-align: center;">🤗 <a href="https://huggingface.co/hkust-nlp/dart-math-llama3-70b-prop2diff">HuggingFace</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>DART-Math-DSMath-7B</code> (Uniform)</td>
<td style="text-align: right;">52.9</td>
<td style="text-align: right;"><strong>88.2</strong></td>
<td style="text-align: right;">40.1</td>
<td style="text-align: center;">🤗 <a href="https://huggingface.co/hkust-nlp/dart-math-dsmath-7b-uniform">HuggingFace</a></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>DART-Math-DSMath-7B</code> (Prop2Diff)</td>
<td style="text-align: right;"><strong>53.6</strong></td>
<td style="text-align: right;">86.8</td>
<td style="text-align: right;"><strong>40.7</strong></td>
<td style="text-align: center;">🤗 <a href="https://huggingface.co/hkust-nlp/dart-math-dsmath-7b-prop2diff">HuggingFace</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>DART-Math-Mistral-7B</code> (Uniform)</td>
<td style="text-align: right;">43.5</td>
<td style="text-align: right;"><strong>82.6</strong></td>
<td style="text-align: right;">26.9</td>
<td style="text-align: center;">🤗 <a href="https://huggingface.co/hkust-nlp/dart-math-mistral-7b-uniform">HuggingFace</a></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>DART-Math-Mistral-7B</code> (Prop2Diff)</td>
<td style="text-align: right;"><strong>45.5</strong></td>
<td style="text-align: right;">81.1</td>
<td style="text-align: right;"><strong>29.4</strong></td>
<td style="text-align: center;">🤗 <a href="https://huggingface.co/hkust-nlp/dart-math-mistral-7b-prop2diff">HuggingFace</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>DART-Math-Llama3-8B</code> (Uniform)</td>
<td style="text-align: right;">45.3</td>
<td style="text-align: right;"><strong>82.5</strong></td>
<td style="text-align: right;">27.1</td>
<td style="text-align: center;">🤗 <a href="https://huggingface.co/hkust-nlp/dart-math-llama3-8b-uniform">HuggingFace</a></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>DART-Math-Llama3-8B</code> (Prop2Diff)</td>
<td style="text-align: right;"><strong>46.6</strong></td>
<td style="text-align: right;">81.1</td>
<td style="text-align: right;"><strong>28.8</strong></td>
<td style="text-align: center;">🤗 <a href="https://huggingface.co/hkust-nlp/dart-math-llama3-8b-prop2diff">HuggingFace</a></td>
</tr>
</tbody>
</table>
<p><sup>MATH and GSM8K are <b>in-domain</b>, while CollegeMath is <b>out-of-domain</b>. <strong>Bold</strong> means the best score on the respective base model here.</sup></p>
<section id="dart-math-models-sota-on-various-in-domain-and-out-of-domain-benchmarks" class="level2">
<h2 class="anchored" data-anchor-id="dart-math-models-sota-on-various-in-domain-and-out-of-domain-benchmarks"><code>DART-Math</code> Models: SOTA on Various In-Domain and Out-of-Domain Benchmarks</h2>
<p><code>DART-Math</code> models achieve performance <strong>superior or competitive to previous SOTAs</strong> on 2 in-domain and 4 challenging out-of-domain mathematical reasoning benchmarks, despite using <strong>much smaller datasets</strong> and <strong>no proprietary model like GPT-4</strong>.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;"><a href="https://huggingface.co/datasets/hendrycks/competition_math">MATH</a></th>
<th style="text-align: right;"><a href="https://huggingface.co/datasets/gsm8k">GSM8K</a></th>
<th style="text-align: right;"><a href="https://github.com/hkust-nlp/dart-math/tree/main/data/eval-dsets/mwpbench/college-math-test.jsonl">College</a></th>
<th style="text-align: right;"><a href="https://github.com/hkust-nlp/dart-math/tree/main/data/eval-dsets/deepmind-mathematics.json">DM</a></th>
<th style="text-align: right;"><a href="https://github.com/hkust-nlp/dart-math/tree/main/data/eval-dsets/olympiadbench/OE_TO_maths_en_COMP.json">Olympiad</a></th>
<th style="text-align: right;"><a href="https://github.com/hkust-nlp/dart-math/tree/main/data/eval-dsets/theoremqa.json">Theorem</a></th>
<th style="text-align: right;">AVG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">GPT-4 (0314)</td>
<td style="text-align: right;"><a href="https://arxiv.org/abs/2403.04706">52.6</a></td>
<td style="text-align: right;"><a href="https://arxiv.org/abs/2403.04706">94.7</a></td>
<td style="text-align: right;"><a href="https://arxiv.org/abs/2403.02884">24.4</a></td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">Llama3-70B-MetaMath</td>
<td style="text-align: right;">44.9</td>
<td style="text-align: right;">88.0</td>
<td style="text-align: right;">31.9</td>
<td style="text-align: right;">53.2</td>
<td style="text-align: right;">11.6</td>
<td style="text-align: right;">21.9</td>
<td style="text-align: right;">41.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://huggingface.co/hkust-nlp/dart-math-llama3-70b-prop2diff"><code>DART-Math-Llama3-70B</code></a></td>
<td style="text-align: right;"><strong>56.1</strong></td>
<td style="text-align: right;"><strong>89.6</strong></td>
<td style="text-align: right;"><strong>37.9</strong></td>
<td style="text-align: right;"><strong>64.1</strong></td>
<td style="text-align: right;"><strong>20.0</strong></td>
<td style="text-align: right;"><strong>28.2</strong></td>
<td style="text-align: right;"><strong>49.3</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;">DeepSeekMath-7B-MetaMath</td>
<td style="text-align: right;">43.7</td>
<td style="text-align: right;">81.8</td>
<td style="text-align: right;">33.7</td>
<td style="text-align: right;">53.0</td>
<td style="text-align: right;">13.6</td>
<td style="text-align: right;">23.2</td>
<td style="text-align: right;">41.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://huggingface.co/deepseek-ai/deepseek-math-7b-rl">DeepSeekMath-7B-RL</a></td>
<td style="text-align: right;">53.1</td>
<td style="text-align: right;">88.4</td>
<td style="text-align: right;">41.3</td>
<td style="text-align: right;">58.3</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">35.9</td>
<td style="text-align: right;">49.3</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://huggingface.co/hkust-nlp/dart-math-dsmath-7b-prop2diff"><code>DART-Math-DSMath-7B</code></a></td>
<td style="text-align: right;"><strong>53.6</strong></td>
<td style="text-align: right;"><strong>86.8</strong></td>
<td style="text-align: right;"><strong>40.7</strong></td>
<td style="text-align: right;"><strong>61.6</strong></td>
<td style="text-align: right;"><strong>21.7</strong></td>
<td style="text-align: right;"><strong>32.2</strong></td>
<td style="text-align: right;"><strong>49.4</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mistral-7B-MetaMath</td>
<td style="text-align: right;">29.8</td>
<td style="text-align: right;">76.5</td>
<td style="text-align: right;">19.3</td>
<td style="text-align: right;">28.0</td>
<td style="text-align: right;">5.9</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">28.9</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://huggingface.co/hkust-nlp/dart-math-mistral-7b-prop2diff"><code>DART-Math-Mistral-7B</code></a></td>
<td style="text-align: right;"><strong>45.5</strong></td>
<td style="text-align: right;"><strong>81.1</strong></td>
<td style="text-align: right;"><strong>29.4</strong></td>
<td style="text-align: right;"><strong>45.1</strong></td>
<td style="text-align: right;"><strong>14.7</strong></td>
<td style="text-align: right;"><strong>17.0</strong></td>
<td style="text-align: right;"><strong>38.8</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Llama3-8B-MetaMath</td>
<td style="text-align: right;">32.5</td>
<td style="text-align: right;">77.3</td>
<td style="text-align: right;">20.6</td>
<td style="text-align: right;">35.0</td>
<td style="text-align: right;">5.5</td>
<td style="text-align: right;">13.8</td>
<td style="text-align: right;">30.8</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://huggingface.co/hkust-nlp/dart-math-llama3-8b-prop2diff"><code>DART-Math-Llama3-8B</code></a></td>
<td style="text-align: right;"><strong>46.6</strong></td>
<td style="text-align: right;"><strong>81.1</strong></td>
<td style="text-align: right;"><strong>28.8</strong></td>
<td style="text-align: right;"><strong>48.0</strong></td>
<td style="text-align: right;"><strong>14.5</strong></td>
<td style="text-align: right;"><strong>19.4</strong></td>
<td style="text-align: right;"><strong>39.7</strong></td>
</tr>
</tbody>
</table>
<p><sup><strong>Abbreviations</strong>: College (CollegeMath), DM (DeepMind Mathematics), Olympiad (OlympiadBench-Math), Theorem (TheoremQA). <strong>Bold</strong> means the best score by SFT on the respective base model here. <code>DART-Math</code> models here are fine-tuned on the <a href="https://huggingface.co/datasets/hkust-nlp/dart-math-hard"><code>DART-Math-Hard</code> dataset</a>.</sup></p>
</section>
<section id="dart-math-datasets-sota-data-efficient-open-source" class="level2">
<h2 class="anchored" data-anchor-id="dart-math-datasets-sota-data-efficient-open-source"><code>DART-Math</code> Datasets: SOTA &amp; Data-Efficient &amp; Open-Source</h2>
<p><code>DART-Math</code> are the <strong>state-of-the-art</strong> and <strong>data-efficient</strong> <strong>open-source</strong> instruction tuning datasets for mathematical reasoning.</p>
<p>Most of previous datasets are <strong>constructed with ChatGPT</strong>, and many of them are <strong>not open-source</strong>, especially for ones of the best performance.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Math SFT Dataset</th>
<th style="text-align: right;"># of Samples</th>
<th style="text-align: right;"><a href="https://huggingface.co/datasets/hendrycks/competition_math">MATH</a></th>
<th style="text-align: right;"><a href="https://huggingface.co/datasets/gsm8k">GSM8K</a></th>
<th style="text-align: right;"><a href="https://github.com/hkust-nlp/dart-math/tree/main/data/eval-dsets/mwpbench/college-math-test.jsonl">College</a></th>
<th style="text-align: left;">Synthesis Agent(s)</th>
<th style="text-align: center;">Open-Source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><a href="https://arxiv.org/abs/2308.09583">WizardMath</a></td>
<td style="text-align: right;">96k</td>
<td style="text-align: right;">32.3</td>
<td style="text-align: right;">80.4</td>
<td style="text-align: right;">23.1</td>
<td style="text-align: left;">GPT-4</td>
<td style="text-align: center;">✗</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://arxiv.org/abs/2309.12284">MetaMathQA</a></td>
<td style="text-align: right;">395k</td>
<td style="text-align: right;">29.8</td>
<td style="text-align: right;">76.5</td>
<td style="text-align: right;">19.3</td>
<td style="text-align: left;">GPT-3.5</td>
<td style="text-align: center;"><a href="https://huggingface.co/datasets/meta-math/MetaMathQA">✓</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://arxiv.org/abs/2401.09003">MMIQC</a></td>
<td style="text-align: right;"><strong>2294k</strong></td>
<td style="text-align: right;">37.4</td>
<td style="text-align: right;">75.4</td>
<td style="text-align: right;"><em>28.5</em></td>
<td style="text-align: left;"><strong>GPT-4+GPT-3.5+Human</strong></td>
<td style="text-align: center;"><a href="https://huggingface.co/datasets/Vivacem/MMIQC"><strong>✓</strong></a></td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://arxiv.org/abs/2402.14830">Orca-Math</a></td>
<td style="text-align: right;">200k</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: left;">GPT-4</td>
<td style="text-align: center;"><a href="https://huggingface.co/datasets/microsoft/orca-math-word-problems-200k">✓</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://arxiv.org/abs/2403.04706">Xwin-Math-V1.1</a></td>
<td style="text-align: right;"><strong>1440k</strong></td>
<td style="text-align: right;"><em>45.5</em></td>
<td style="text-align: right;"><strong>84.9</strong></td>
<td style="text-align: right;">27.6</td>
<td style="text-align: left;"><strong>GPT-4</strong></td>
<td style="text-align: center;"><strong>✗</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://arxiv.org/abs/2403.02333">KPMath-Plus</a></td>
<td style="text-align: right;"><strong>1576k</strong></td>
<td style="text-align: right;"><strong>46.8</strong></td>
<td style="text-align: right;">82.1</td>
<td style="text-align: right;">–</td>
<td style="text-align: left;"><strong>GPT-4</strong></td>
<td style="text-align: center;"><strong>✗</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://arxiv.org/abs/2403.02884">MathScaleQA</a></td>
<td style="text-align: right;">2021k</td>
<td style="text-align: right;">35.2</td>
<td style="text-align: right;">74.8</td>
<td style="text-align: right;">21.8</td>
<td style="text-align: left;">GPT-3.5+Human</td>
<td style="text-align: center;">✗</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://huggingface.co/datasets/hkust-nlp/dart-math-uniform"><code>DART-Math-Uniform</code></a></td>
<td style="text-align: right;"><strong>591k</strong></td>
<td style="text-align: right;">43.5</td>
<td style="text-align: right;"><em>82.6</em></td>
<td style="text-align: right;">26.9</td>
<td style="text-align: left;"><strong>DeepSeekMath-7B-RL</strong></td>
<td style="text-align: center;"><a href="https://huggingface.co/datasets/hkust-nlp/dart-math-uniform"><strong>✓</strong></a></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://huggingface.co/datasets/hkust-nlp/dart-math-hard"><code>DART-Math-Hard</code></a></td>
<td style="text-align: right;"><strong>585k</strong></td>
<td style="text-align: right;"><em>45.5</em></td>
<td style="text-align: right;">81.1</td>
<td style="text-align: right;"><strong>29.4</strong></td>
<td style="text-align: left;"><strong>DeepSeekMath-7B-RL</strong></td>
<td style="text-align: center;"><a href="https://huggingface.co/datasets/hkust-nlp/dart-math-hard"><strong>✓</strong></a></td>
</tr>
</tbody>
</table>
<p><sup>MATH and GSM8K are <strong>in-domain</strong>, while College(Math) is <strong>out-of-domain</strong>. Performance here are of models fine-tuned from <a href="https://huggingface.co/mistralai/Mistral-7B-v0.1">Mistral-7B</a>, except for Xwin-Math-V1.1 based on <a href="https://huggingface.co/meta-llama/Llama-2-7b-hf">Llama2-7B</a>. <strong>Bold</strong>/<em>Italic</em> means the best/second best score here.</sup></p>
</section>
<section id="dars-difficulty-aware-rejection-sampling" class="level2">
<h2 class="anchored" data-anchor-id="dars-difficulty-aware-rejection-sampling"><code>DARS</code> – Difficulty-Aware Rejection Sampling</h2>
<p>Our analysis of previous datasets reveals <strong>severe biases towards easy queries</strong>, with <strong>frequent failures to generate any correct response for the most challenging queries</strong>.</p>
<p>This primarily arises from their constuction method, <strong>vanilla rejection sampling</strong>, where <strong>the same number</strong> of responses are sampled for each query, yet the likelihood of obtaining correct responses for difficult queries is significantly lower, sometimes even zero.</p>
<p>Motivated by the observation above and the intuitive that difficult samples are critical for learning complexing reasoning, we propose <strong>Difficulty-Aware Rejection Sampling</strong> (<code>DARS</code>) to eliminate the bias towards easy queries. Specifically, we introduce two strategies to increase the number of correct responses for difficult queries:</p>
<ol type="1">
<li><strong>Uniform</strong>, which involves sampling responses for each query until <strong>each query accumulates <span class="math inline">\(k_u\)</span> correct responses</strong>, where <span class="math inline">\(k_u\)</span> is a preset hyperparameter determined by the desired size of the synthetic dataset;</li>
<li><strong>Prop2Diff</strong>, where we continue sampling responses until the number of correct responses for each query is <strong>proportional to its difficulty score</strong>. The most challenging queries will receive <span class="math inline">\(k_p\)</span> responses and kp is a hyperparameter. This method introduces a deliberate bias in the opposite direction to vanilla rejection sampling, towards more difficult queries, inspired by previous works that demonstrate <strong>difficult samples can be more effective to enhance model capabilities</strong> (<a href="https://proceedings.neurips.cc/paper_files/paper/2022/hash/7b75da9b61eda40fa35453ee5d077df6-Abstract-Conference.html">Sorscher et al., 2022</a>; <a href="https://openreview.net/forum?id=BTKAeLqLMw">Liu et al., 2024b</a>).</li>
</ol>
<p>See <a href="https://tongyx361.github.io/assets/dart-math/main-nresp-vs-query.png">Figure 1 (Right)</a> for examples of <code>DART-Math-Uniform</code> by <code>DARS-Uniform</code> and <code>DART-Math-Hard</code> by <code>DARS-Prop2Diff</code>.</p>
</section>
<section id="quick-start-reproduction" class="level2">
<h2 class="anchored" data-anchor-id="quick-start-reproduction">🚀 Quick Start / Reproduction</h2>
<section id="setup" class="level3">
<h3 class="anchored" data-anchor-id="setup">⚙️ Setup</h3>
<p>We recommend using&nbsp;<a href="https://docs.conda.io/projects/miniconda">Conda</a> and <a href="https://pip.pypa.io/en/stable/#">pip</a>&nbsp;to manage your environment. Run the following commands to setup your environment:</p>
<pre class="shell"><code>git clone https://github.com/hkust-nlp/dart-math.git &amp;&amp; cd dart-math
conda create --name dart-math --yes python=3.11
conda activate dart-math
pip install -r requirements.txt
pip install flash-attn --no-build-isolation</code></pre>
<p>For common users/developers, please just run the following command the install the <code>dart-math</code> package:</p>
<pre class="shell"><code>pip install -e "."</code></pre>
<p>For intended contributors, we recommend installing the package with the <code>dev</code> extras:</p>
<pre class="shell"><code>pip install -e ".[dev]"
pre-commit install
conda install quarto -c conda-forge # for building the documentation</code></pre>
</section>
<section id="training" class="level3">
<h3 class="anchored" data-anchor-id="training">🔨 Training</h3>
<p>We implement an efficient training pipeline utilizing various techniques. Notably, <a href="https://hkust-nlp.github.io/dart-math/train.html#sequence-packing"><strong>sequence packing</strong></a> accelerates training by 6-8x in our setting and possibly more in other settings. (See <a href="https://hkust-nlp.github.io/dart-math/train.html#accelerating-several-times-with-sequence-packing-in-4-lines-of-code">how to integrate sequence packing in 4 lines of code</a>.)</p>
<p>Please refer to</p>
<ul>
<li>the <a href="https://github.com/hkust-nlp/dart-math/blob/main/pipeline/train.py">training Python script</a> for code of training based on the <a href="https://huggingface.co/docs/transformers/en/main_classes/trainer">HuggingFace <code>Trainer</code></a> and utilizing <a href="https://hkust-nlp.github.io/dart-math/train.html#sequence-packing">sequence packing</a>.</li>
<li>the <a href="https://github.com/hkust-nlp/dart-math/blob/main/scripts/train-single-node.sh">single-node</a>/<a href="https://github.com/hkust-nlp/dart-math/blob/main/scripts/train-multi-node.sh">multi-node</a> training <code>bash</code> script for code of training based on <a href="https://huggingface.co/docs/accelerate/index">HuggingFace <code>accelerate</code></a> and <a href="https://www.deepspeed.ai"><code>deepspeed</code></a></li>
</ul>
<p>Here, we provide some example commands as well as reproduction instructions for our work:</p>
<section id="single-node-training" class="level4">
<h4 class="anchored" data-anchor-id="single-node-training">Single-Node Training</h4>
<p>For example, to reproduce training <code>DART-Math-Llama3-8B-Prop2Diff</code> on a node of 8 A100 GPUs, please run the following command:</p>
<pre class="shell"><code>bash scripts/train-single-node.sh \
    --data_path "hkust-nlp/dart-math-hard" \
    --model_path "meta-llama/Meta-Llama-3-8B" \
    --lr "5e-5" --bs 64 --n_grad_acc_steps 1 --n_epochs 1 \
    --gpu_ids "0,1,2,3,4,5,6,7" \
    --output_dir "models/dart-math-llama3-8b-prop2diff"</code></pre>
<p>To reproduce other training settings, just refer to the paper and modify the <code>--data_path</code>, <code>--model_path</code>, <code>--lr</code>, <code>--n_grad_acc_steps</code>, <code>--n_epochs</code> and <code>--output_dir</code> arguments accordingly.</p>
</section>
<section id="multi-node-training" class="level4">
<h4 class="anchored" data-anchor-id="multi-node-training">Multi-Node Training</h4>
<p>To reproduce training <code>DART-Math-Llama3-70B-Prop2Diff</code> on 4 nodes of 8 A100 GPUs, please first edit the <code>cfgs/deepspeed/hostfile</code> according to your enviroment and then run the following command:</p>
<pre class="shell"><code>bash scripts/train-multi-node.sh \
    --data_path "hkust-nlp/dart-math-hard" \
    --model_path "meta-llama/Meta-Llama-3-70B" \
    --lr "2e-5" --bs 64 --n_grad_acc_steps 1 --n_epochs 1 \
    --n_nodes 4 \
    --output_dir "models/dart-math-llama3-70b-prop2diff"</code></pre>
<p>To reproduce training <code>DART-Math-Llama3-70B-Uniform</code> on 4 nodes of 8 A100 GPUs, just change <code>--data_path</code> to <code>"hkust-nlp/dart-math-uniform"</code>.</p>
<details>
<summary>
The off-the-shelf command to train <code>DART-Math-Llama3-70B-Uniform</code>
</summary>
<pre class="shell"><code>bash scripts/train-multi-node.sh \
    --data_path "hkust-nlp/dart-math-uniform" \
    --model_path "meta-llama/Meta-Llama-3-70B" \
    --lr "2e-5" --bs 64 --n_grad_acc_steps 1 --n_epochs 1 \
    --n_nodes 4 \
    --output_dir "models/dart-math-llama3-70b-prop2diff"</code></pre>
</details>
</section>
</section>
<section id="evaluation" class="level3">
<h3 class="anchored" data-anchor-id="evaluation">⚖️ Evaluation</h3>
<p>We utilize <a href="https://docs.vllm.ai/en/latest/index.html">vLLM</a> to accelerate inference and an elaborate answer extraction and correctness judgement pipeline based on regular expressions and <a href="https://www.sympy.org">SymPy</a> symbolic calculation, which is able to correctly process</p>
<ul>
<li>most <strong>mathematical objects</strong> such as matrices (vectors), intervals, symbols besides numbers,</li>
<li>as well as some <strong>special texts</strong> like bool expressions, dates and times.</li>
</ul>
<p>For example, to reproduce one pass of greedy decoding with <code>DART-Math-Mistral-7B-Prop2Diff</code> on the 6 benchmarks in Table 2 on GPU 0, please run the following command:</p>
<pre class="shell"><code>CUDA_VISIBLE_DEVICES="0" python pipeline/gen.py \
    --gen_save_path "data/res/dart-math-mistral-7b-prop2diff.jsonl" \
    --model_name_or_path "hkust-nlp/dart-math-mistral-7b-prop2diff" \
    --datasets "math/test" "gsm8k/test" "mwpbench/college-math/test" "deepmind-mathematics" \
        "olympiadbench/OE_TO_maths_en_COMP" "theoremqa" \
    --max_new_toks 2048 --temperature 0 \
    --prompt_template "cot" --n_shots -1 \
    --inf_seed -1 \
    --max_n_trials 1</code></pre>
<p>To reproduce other inference settings, just refer to the paper and modify the <code>--model_name_or_path</code> and <code>--gen_save_path</code> arguments accordingly.</p>
<ul>
<li>We observed that Llama-3-8B(-Base) tends to decode EoS immediately sometimes. Try use <code>--ignore_eos</code> as a workaround.</li>
</ul>
<p>For other general inference settings, please modify the command or directly modify the <a href="https://github.com/hkust-nlp/dart-math/blob/main/pipeline/gen.py">script</a>.</p>
<ul>
<li>To test <strong>base</strong> models, please add the corresponding <strong>ID</strong> to <code>BASE_MODEL_IDS</code> from <a href="https://github.com/hkust-nlp/dart-math/blob/main/dart_math/utils.py">dart_math.utils</a>.</li>
<li>To test <strong>instruct</strong> models, please add the corresponding <strong>prompt template</strong> to <code>PROMPT_TEMPLATE_ID2DICT</code> from <a href="https://github.com/hkust-nlp/dart-math/blob/main/dart_math/utils.py">dart_math.utils</a> and specify with <code>--prompt_template</code>.</li>
</ul>
<p>You can also add the <code>--gen_only</code> option to only generate responses without evaluation and use the <a href="https://hkust-nlp.github.io/dart-math/eval.html#evaluatormathbatch"><code>EvaluatorMathBatch</code></a> to grade the generations by yourself. Please check the <a href="pipeline/grade.py">grading script</a> for example.</p>
</section>
<section id="data-synthesis" class="level3">
<h3 class="anchored" data-anchor-id="data-synthesis">🗂 Data Synthesis</h3>
<p>Our data synthesis pipeline is compatible with the evaluation pipeline, please <strong>modify the <code>--min_n_corrects</code> and <code>--max_n_trials</code> arguments</strong> to meet your needs.</p>
<p>For example, to reproduce the <strong>synthesis of <code>DART-Math-Uniform</code></strong>, amortizing the workload to multiple GPUs, please run the following command:</p>
<pre class="shell"><code>gpu_ids_list=("0" "1" "2" "3" "4" "5" "6" "7")
min_n_corrects=40
min_n_corrects_per_gpu=$((min_n_corrects / ${#gpu_ids_list[@]})) # 5 here

mkdir -p logs
for gpu_ids in "${gpu_ids_list[@]}"; do
    exp_name="dart-math-uniform-gpu${gpu_ids}"
    CUDA_VISIBLE_DEVICES="${gpu_ids}" python pipeline/gen.py \
        --gen_save_path "data/res/${exp_name}.jsonl" \
        --model_name_or_path "deepseek-ai/deepseek-math-7b-rl" \
        --datasets "math/train" "gsm8k-fix/train" \
        --max_new_toks 2048 --temperature 1.6 --top_p 0.95 \
        --prompt_template "deepseekmath" --n_shots 0 \
        --inf_seed -1 \
        --min_n_corrects "${min_n_corrects_per_gpu}" --max_n_trials 0 \
        &gt;"logs/${exp_name}.log" 2&gt;&amp;1 &amp;
    # NOTE: `--max_n_trials 0` means possible infinite trials, kill the job manually when needed
done</code></pre>
<p><sup>NOTE: Some <strong>erroneous labels</strong> exist in the GSM8K dataset, so we tried to fix them and produced <a href="https://huggingface.co/datasets/hkust-nlp/gsm8k-fix"><code>gsm8k-fix</code></a>. </sup></p>
<p>To reproduce the data synthesis of the <strong>Vanilla Rejection Tuning (VRT) baseline</strong> in the paper, just set <code>--max_n_trials 52 --min_n_corrects 0</code>.</p>
<details>
<summary>
The off-the-shelf command to reproduce the synthesis of the Vanilla Rejection Tuning (VRT) baseline in the paper
</summary>
<pre class="shell"><code>CUDA_VISIBLE_DEVICES="0" python pipeline/gen.py \
    --gen_save_path "data/res/dart-math-uniform.jsonl" \
    --model_name_or_path "deepseek-ai/deepseek-math-7b-rl" \
    --datasets "math/train" "gsm8k-fix/train" \
    --max_new_tokens 2048 --temperature 1.6 --top_p 0.95 \
    --prompt_template "cot" --n_shots 0 \
    --inf_seed -1 \
    --max_n_trials 52 --min_n_corrects 0 # no requirement for correct responses</code></pre>
</details>
<details>
<summary>
So sorry that it still need some manual efforts to reproduce the data synthesis of <code>DART-Math-Prop2Diff</code>. For now, please follow the instructions in the paper
</summary>
<ol type="1">
<li>Calculate “fail rate” (<code>1-pass_rate</code>) for each query in MATH and GSM8K training sets (see the <code>pass_rate</code> field of query information in <a href="https://huggingface.co/datasets/hkust-nlp/dart-math-pool-math-query-info">MATH</a> and <a href="https://huggingface.co/datasets/hkust-nlp/dart-math-pool-gsm8k-query-info">GSM8K</a>).</li>
<li>Calculate the target number of correct responses for each query in the final training set. Note that we try to ensure at least one correct response for each query in the <code>DART-Math</code> datasets, which you could implement by rounding <strong>up</strong> when calculating the response number for each query.</li>
<li>Sample responses for each query until the target number of correct ones is met (thus proportional to its “fail rate”).</li>
</ol>
</details>
<p>After the synthesis, you can use the <a href="pipeline/curate.py">curation script</a> to curate the final dataset.</p>
</section>
</section>
<section id="dart-math-package-efficient-and-flexible-training-inference-evaluation-pipelines" class="level2">
<h2 class="anchored" data-anchor-id="dart-math-package-efficient-and-flexible-training-inference-evaluation-pipelines"><a href="https://hkust-nlp.github.io/dart-math"><code>dart-math</code> Package</a>: Efficient and Flexible Training &amp; Inference &amp; Evaluation Pipelines</h2>
<p>We package our code of effcient and flexible training &amp; inference &amp; evaluation pipelines into <code>dart-math</code> and document it at <a href="https://hkust-nlp.github.io/dart-math/quick-start.html">this website</a>.</p>
<p>The <code>dart-math</code> package provides the following useful features besides ones mentioned above:</p>
<section id="tool-integrated-reasoning-reasoning-in-natural-language-interleaved-with-python-code" class="level3">
<h3 class="anchored" data-anchor-id="tool-integrated-reasoning-reasoning-in-natural-language-interleaved-with-python-code"><strong>Tool-integrated reasoning</strong>: reasoning in natural language interleaved with Python code</h3>
<p>Example command to evaluate DeepSeekMath-7B-RL with tool-integrated reasoning (following the DeepSeekMath offical setting):</p>
<pre class="shell"><code>CUDA_VISIBLE_DEVICES="0" python pipeline/gen.py \
    --gen_save_path "data/res/dsmath-7b-rl-tool-math-test.jsonl" \
    --model_name_or_path "deepseek-ai/deepseek-math-7b-rl" \
    --datasets "math-test" \
    --max_new_toks 2048 --temperature 0 \
    --prompt_template "deepseekmath-tool" --n_shots 0 \
    --max_n_calls 1 --trunc_len 50 50 \
    --inf_seed -1 \
    --max_n_trials 1
# Reproduced performance (with our evaluator): 56.08%
# (58.8% reported originally with DeepSeekMath evaluator)</code></pre>
<p>For other general inference settings, please modify the options related to the <a href="https://hkust-nlp.github.io/dart-math/gen.html#:~:text=means%20no%20evaluation.-,code_exec_cfg,-dart_math.exec.CodeExecCfg"><code>Generator.code_exec_cfg</code> attribute</a> in the command or the <a href="https://github.com/hkust-nlp/dart-math/blob/main/pipeline/gen.py">script</a>.</p>
</section>
</section>
<section id="contribution" class="level2">
<h2 class="anchored" data-anchor-id="contribution">🍀 Contribution</h2>
<section id="file-structure" class="level3">
<h3 class="anchored" data-anchor-id="file-structure">File Structure</h3>
<pre class="tree"><code>dart-math
├── data
├── cfgs # Configurations
├── utils # Repository utilities
├── dart_math # Package code for common utilities
├── nbs # Notebooks and other files to run tests and generate documentation with https://nbdev.fast.ai
├── pipeline # Reusable (Python / Shell) scripts or notebooks
└── scripts # Setting-specific scripts</code></pre>
</section>
<section id="checklist-before-commit" class="level3">
<h3 class="anchored" data-anchor-id="checklist-before-commit">Checklist Before Commit</h3>
<section id="prepare-commit.sh" class="level4">
<h4 class="anchored" data-anchor-id="prepare-commit.sh"><a href="utils/prepare-commit.sh"><code>prepare-commit.sh</code></a></h4>
<p>Run the <a href="utils/prepare-commit.sh"><code>prepare-commit.sh</code></a> to clean the notebooks and export scripts for pipeline notebooks, generate documentation, run tests, render README if needed:</p>
<pre class="shell"><code>bash utils/prepare-commit.sh</code></pre>
<p>Please refer to the comments in the script for how it works.</p>
</section>
<section id="manual-modification-list" class="level4">
<h4 class="anchored" data-anchor-id="manual-modification-list">Manual Modification List</h4>
<ul>
<li>Add <code>if __name__ == "__main__":</code> to scripts that might use vLLM tensor parallelism
<ul>
<li><a href="pipeline/gen.py"><code>gen.py</code></a></li>
</ul></li>
</ul>
</section>
</section>
</section>
<section id="star-history" class="level2">
<h2 class="anchored" data-anchor-id="star-history">🌟 Star History</h2>
<p><a href="https://star-history.com/#hkust-nlp/dart-math&amp;Date"> <picture> <source media="(prefers-color-scheme: dark)" srcset="https://api.star-history.com/svg?repos=hkust-nlp/dart-math&amp;type=Date&amp;theme=dark"> <source media="(prefers-color-scheme: light)" srcset="https://api.star-history.com/svg?repos=hkust-nlp/dart-math&amp;type=Date"> <img alt="Star History Chart" src="https://api.star-history.com/svg?repos=hkust-nlp/dart-math&amp;type=Date"> </picture> </a></p>
</section>
<section id="acknowledgements" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgements">🙏 Acknowledgements</h2>
<p>Thanks to:</p>
<ul>
<li><a href="https://nbdev.fast.ai/"><code>nbdev</code></a> for generating the <a href="https://hkust-nlp.github.io/dart-math">wonderful documentation website</a>,</li>
<li><a href="https://github.com/tatsu-lab/stanford_alpaca"><code>stanford_alpaca</code></a> for reference code about training,</li>
<li><a href="https://github.com/MeetKai/functionary/tree/main/functionary/train/packing"><code>functionary</code></a> for reference code about <a href="https://hkust-nlp.github.io/dart-math/train.html#sequence-packing">sequence packing</a>.</li>
<li><span class="citation" data-cites="HYZ17">@HYZ17</span> for extensive tests and helpful suggestions.</li>
</ul>
</section>
<section id="citation" class="level2">
<h2 class="anchored" data-anchor-id="citation">☕️ Citation</h2>
<p>If you find our data, model or code useful for your work, please kindly cite <a href="https://arxiv.org/abs/2407.13690">our paper</a>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode latex code-with-copy"><code class="sourceCode latex"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>@article{tong2024dartmath,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  title={DART-Math: Difficulty-Aware Rejection Tuning for Mathematical Problem-Solving},</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  author={Yuxuan Tong and Xiwen Zhang and Rui Wang and Ruidong Wu and Junxian He},</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  year={2024},</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  eprint={2407.13690},</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  archivePrefix={arXiv},</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  primaryClass={cs.CL},</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  url={https://arxiv.org/abs/2407.13690},</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/hkust-nlp\.github\.io\/dart-math");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
      <a href="./quick-start.html" class="pagination-link" aria-label="Quick Start">
        <span class="nav-page-text">Quick Start</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/hkust-nlp/dart-math/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>